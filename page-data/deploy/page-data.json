{"componentChunkName":"component---src-pages-blog-post-js","path":"/deploy/","result":{"data":{"site":{"siteMetadata":{"title":"klloo"}},"markdownRemark":{"id":"4d9d8f78-9ab5-528a-8fbf-892acff26925","excerpt":"ìµœê·¼ ì œê°€ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë””ë¥¼ ìœ„í•œ ë‚´ë¶€ ì‚¬ì´íŠ¸ë¥¼ ì œì‘í•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ìˆì—ˆëŠ”ë°ìš”. ì–´ëŠì •ë„ í˜•íƒœê°€ ê°–ì¶”ì–´ì§€ë©´ì„œ ì´ì œ ì‚¬ìš©í•´ë„ ì¢‹ê² ë‹¤! ì‹¶ì–´ ì¼ë‹¨ ë°°í¬ë¥¼ í•´ë‘ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤ ì „ì²´ì ì¸ êµ¬ì¡°  ì „ì²´ì ì¸ êµ¬ì¡°ëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.\në¨¼ì € AWSì˜ EC2ì™€ RDSâ€¦","html":"<p>ìµœê·¼ ì œê°€ ì°¸ì—¬í•˜ê³  ìˆëŠ” ì•Œê³ ë¦¬ì¦˜ ìŠ¤í„°ë””ë¥¼ ìœ„í•œ ë‚´ë¶€ ì‚¬ì´íŠ¸ë¥¼ ì œì‘í•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê³  ìˆì—ˆëŠ”ë°ìš”. ì–´ëŠì •ë„ í˜•íƒœê°€ ê°–ì¶”ì–´ì§€ë©´ì„œ ì´ì œ ì‚¬ìš©í•´ë„ ì¢‹ê² ë‹¤! ì‹¶ì–´ ì¼ë‹¨ ë°°í¬ë¥¼ í•´ë‘ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤</p>\n<h2>ì „ì²´ì ì¸ êµ¬ì¡°</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; overflow: hidden!important; border-radius: 8px!important; margin-left: 0!important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3efdfd7a8f6f0f8275dd63d5ab91acf5/5a6dd/structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.79710144927537%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeklEQVR42o1Sy27CMBDMl/dveuPWD+ipUoW4UKQeWlSkFlAeBNvBxolf07VRIkihwtLKyXp3dnZ3Mlw7wZOF4VeZgJ0MMA7wYRQaLh0Z/jl9qNABP8yjEhpSGzjnbuZko3LpkssZzO47AQbvE3RkIgSHlAe0bZviPNGtm/a8mRPgQJvu+FVPn2DXC/jkc6ilxXxroNUR1joCSi/YC4mHxyk0zSJ4l3D+tkwPG2GwKFyapXcWedPhdc1gvIKxhpiKwZhooFsNY+wJMFZbLpdQSkFrje6oaF5HzAuaVyOQ5wX5JT52L/jav0O1CozxBHZoGnClwVkB0+nUXWatxWQyQVmW4Jyj4Q3WbE2AczgTGRpUxPAtp5aIraeFxJyYHRnFBUXrx5CNV++dB5MMpaxSgboqsdpxPK82sBRWWA/bdQlgLJkLwN5i9XFgcSgw206xl0d87gW11yLcJZskBWJArUXr2+lMR8sgH92WJGPv1uGZ+q/ZIPYQbgL+AjGYW6WgXw4JAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"structure\"\n        title=\"\"\n        src=\"/static/3efdfd7a8f6f0f8275dd63d5ab91acf5/dd45a/structure.png\"\n        srcset=\"/static/3efdfd7a8f6f0f8275dd63d5ab91acf5/948cf/structure.png 138w,\n/static/3efdfd7a8f6f0f8275dd63d5ab91acf5/6b2ea/structure.png 275w,\n/static/3efdfd7a8f6f0f8275dd63d5ab91acf5/dd45a/structure.png 550w,\n/static/3efdfd7a8f6f0f8275dd63d5ab91acf5/5a6dd/structure.png 802w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ì „ì²´ì ì¸ êµ¬ì¡°ëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.\në¨¼ì € AWSì˜ EC2ì™€ RDSë¥¼ ìƒì„±í•˜ì˜€ê³  spring boot ì½”ë“œì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ RDSì™€ ì—°ë™í•´ë‘ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  EC2 ë‚´ë¶€ì—ì„œëŠ” ë„ì»¤ë¥¼ ì‚¬ìš©í•´ì„œ ì´ 3ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ë„ì› ìŠµë‹ˆë‹¤.</p>\n<ol>\n<li>Reverse Proxy ì„œë²„ë¡œ ì‚¬ìš©í•  Nginx</li>\n<li>Spring boot</li>\n<li>Web Serverë¡œ ì‚¬ìš©í•  Nginx (ë¹Œë“œëœ React íŒŒì¼ì´ ë§ˆìš´íŠ¸ ë˜ì–´ ìˆìŒ)</li>\n</ol>\n<p>ì™¸ë¶€ì—ì„œ 443ìœ¼ë¡œ ìš”ì²­ì´ ì˜¤ë©´ Reverse Proxy ì„œë²„ì¸ Nginxê°€ ë¨¼ì € ìš”ì²­ì„ ë°›ê³ , /apië¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì´ë¼ë©´ 8080í¬íŠ¸ë¡œ, ê·¸ëƒ¥ /ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì´ë¼ë©´ 3000 í¬íŠ¸ë¡œ ìš”ì²­ì„ ì „ë‹¬í•´ì£¼ê²Œ ë©ë‹ˆë‹¤.</p>\n<p>ì—¬ê¸°ì„œ <strong>ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ</strong>ë€ í´ë¼ì´ì–¸íŠ¸ì™€ ì›¹ ì„œë²„ ì‚¬ì´ì— ìœ„ì¹˜í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ì„œë²„ë¡œ ì „ë‹¬í•˜ê³ , ì„œë²„ì—ì„œ ë°›ì€ ì‘ë‹µì„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•˜ëŠ” ì¤‘ê°„ ì„œë²„ ì—­í• ì„ í•˜ëŠ” ì„œë²„ë¥¼ ë§í•©ë‹ˆë‹¤.\në¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë©´ ë¡œë“œ ë°¸ëŸ°ì‹±, ë¬´ì¤‘ë‹¨ ë°°í¬ ë“± ì—¬ëŸ¬ ë°©ë©´ì—ì„œ ì´ì ì´ ìˆìŠµë‹ˆë‹¤.</p>\n<p>í•˜ì§€ë§Œ ì œê°€ ë°°í¬í•˜ë ¤ëŠ” ì„œë¹„ìŠ¤ëŠ” ê·œëª¨ê°€ í° ì„œë¹„ìŠ¤ê°€ ì•„ë‹ˆì—ˆê¸° ë•Œë¬¸ì— ì´ëŸ° ë¶€ë¶„ë“¤ì€ í° ê³ ë ¤ ì‚¬í•­ì´ ì•„ë‹ˆì—ˆê³ , CORS ì„¤ì •ì„ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì  ë•Œë¬¸ì— ì´ëŸ° êµ¬ì¡°ë¥¼ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. (Nginx ì„¤ì • ì¤‘ proxy_passë¥¼ í†µí•´ CORSë¥¼ ì‰½ê²Œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>\n<p>ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë„ìš°ëŠ” ê³¼ì •ì€ ì•„ë˜ì™€ ê°™ì´ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.</p>\n<ol>\n<li>ë¡œì»¬ì—ì„œ Frontend ì´ë¯¸ì§€ ë¹Œë“œ</li>\n<li>ë¡œì»¬ì—ì„œ Backend ì´ë¯¸ì§€ ë¹Œë“œ</li>\n<li>Docker hubì— ë¹Œë“œí•œ ì´ë¯¸ì§€ push</li>\n<li>EC2 ë‚´ë¶€ì—ì„œ í•´ë‹¹ ì´ë¯¸ì§€ pull</li>\n<li>docker-composeë¥¼ ì‚¬ìš©í•´ Nginx ì´ë¯¸ì§€ì™€ pullë°›ì€ ë‘ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ì‹¤í–‰</li>\n</ol>\n<p>ë„ì»¤ë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ” ë°°í¬ê°€ í¸ë¦¬í•˜ê¸° ë•Œë¬¸..!ì´ì—ˆìŠµë‹ˆë‹¤. ì•„ì§ ì¸í”„ë¼ì™€ ê´€ë ¨ëœ ì§€ì‹ì´ ë¶€ì¡±í•œ í¸ì¸ë°.. ì¼ë‹¨ ë°°í¬ í™˜ê²½ì„ ì‹ ê²½ ì“¸ í•„ìš”ê°€ ì—†ì—ˆê³  ìˆ˜ì • ì‚¬í•­ì´ ìƒê¸°ë”ë¼ë„ ìƒˆë¡œ ë¹Œë“œí•œ ì´ë¯¸ì§€ë§Œ ê°ˆì•„ë¼ìš°ë©´ ë˜ê¸° ë•Œë¬¸ì— ì´ëŸ° ë°©ì‹ë“¤ì´ ê¹”ë”í•˜ê³  ë§ˆìŒì— ë“¤ì–´ì„œ ì‚¬ìš©ì„ í–ˆìŠµë‹ˆë‹¤!</p>\n<h2>ë°°í¬ ê³¼ì •</h2>\n<p>ìœ„ì—ì„œ ê°„ëµí•˜ê²Œ ì„¤ëª…í•œ ë°°í¬ ê³¼ì •ì„ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<h3>ë„ë©”ì¸ êµ¬ì… ë° ì—°ë™</h3>\n<p>ë„ë©”ì¸ì€ <a href=\"https://domain.gabia.com/\">ê°€ë¹„ì•„</a>ì—ì„œ êµ¬ë§¤ë¥¼ í–ˆìŠµë‹ˆë‹¤. 1ë…„ì¹˜ë¥¼ êµ¬ë§¤í–ˆê³ ìš” ...\nì—¬ëŸ¬ ë„ë©”ì¸ì„ ê²€ìƒ‰í•´ë³´ë©° ê°€ê²©ì„ ë¹„êµí•˜ëŠ”ê²Œ ê½¤ë‚˜ ì¬ë°Œì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³  <a href=\"https://developer-ping9.tistory.com/320\">ì´ ë¸”ë¡œê·¸</a>ë¥¼ ì°¸ê³ í•˜ì—¬ EC2ì™€ ë„ë©”ì¸ì„ ì—°ê²°í–ˆìŠµë‹ˆë‹¤.</p>\n<h3>ë„ì»¤ íŒŒì¼ ì‘ì„±</h3>\n<p>ë¡œì»¬ì—ì„œ frontendìª½ ì´ë¯¸ì§€ì™€ backendìª½ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê¸° ìœ„í•œ ë„ì»¤ íŒŒì¼ì„ ì‘ì„±í•´ë’€ìŠµë‹ˆë‹¤.</p>\n<h4>frontend</h4>\n<deckgo-highlight-code language=\"dockerfile\"  >\n          <code slot=\"code\">FROM node:alpine as builder\nWORKDIR /usr/src/app\nCOPY package.json .\nRUN yarn install\nCOPY ./ ./\nRUN yarn build\n\nFROM nginx\nEXPOSE 3000\nCOPY ./nginx.conf /etc/nginx/conf.d/default.conf\nCOPY --from=builder usr/src/app/build  /usr/share/nginx/html</code>\n        </deckgo-highlight-code>\n<p>ì´ ë„ì»¤íŒŒì¼ì„ í•´ì„í•´ ë³´ìë©´ ...</p>\n<p>ë¨¼ì € node ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ React ì½”ë“œë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.\npackage.json íŒŒì¼ì„ ì»¨í…Œì´ë„ˆì˜ ì‘ì—… ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•˜ì—¬ yarn installì„ í†µí•´ í•„ìš”í•œ ì¢…ì†ì„±ì„ ì„¤ì¹˜í•˜ê³ , í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ ì „ì²´ë¥¼ ì»¨í…Œì´ë„ˆì˜ ì‘ì—… ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•˜ì—¬ yarn build ëª…ë ¹ì–´ë¥¼ í†µí•´ React ì½”ë“œë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³  nginx ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì›¹ì„œë²„ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.\në¨¼ì € ì»¨í…Œì´ë„ˆ ì™¸ë¶€ë¡œ 3000 í¬íŠ¸ë¥¼ ì—´ê³  í˜„ì¬ ë””ë ‰í† ë¦¬ì— ì‘ì„±í•´ë‘” nginx ì„¤ì •íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ nginx ì„¤ì •íŒŒì¼ë¡œ ë³µì‚¬í•´ì¤ë‹ˆë‹¤.\nê·¸ë¦¬ê³  ì´ì „ builder ë‹¨ê³„ì—ì„œ ë¹Œë“œí•œ íŒŒì¼ì„ nginxì˜ ê¸°ë³¸ ì›¹ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.</p>\n<p>ì‘ì„±í•œ nginx ì„¤ì • íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>\n<h4>nginx.conf</h4>\n<deckgo-highlight-code   >\n          <code slot=\"code\">server {\n    listen 3000;\n\n    location / {\n        root /usr/share/nginx/html;\n        index index.html index.htm;\n        try_files $uri  $uri/ /index.html;\n    }\n    underscores_in_headers on;\n}</code>\n        </deckgo-highlight-code>\n<p>ë¨¼ì € 3000 í¬íŠ¸ë¡œ ìš”ì²­ì„ ë°›ê¸°ë¡œ í•©ë‹ˆë‹¤.\nê·¸ë¦¬ê³  '/'ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ nginx ê¸°ë³¸ ì›¹ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì •ì  íŒŒì¼ë“¤ì„ ì œê³µí•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p>\n<p><code class=\"language-text\">underscores_in_headers on</code>ì€ httpìš”ì²­ í—¤ë”ì—ì„œ underscore(_)ë¥¼ í—ˆìš©í•˜ë„ë¡í•˜ëŠ” ì˜µì…˜ì…ë‹ˆë‹¤. nginxëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í—¤ë”ì— underscoreê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ í•´ë‹¹ í—¤ë”ë¥¼ ìë™ìœ¼ë¡œ ë²„ë ¤ë²„ë¦°ë‹¤ê³  í•©ë‹ˆë‹¤... ì €í¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì¸ì¦ ì‹œ ì‚¬ìš©í•˜ëŠ” í† í°ì„ ìš”ì²­ í—¤ë”ì—ì„œ ì£¼ê³  ë°›ì„ ë•Œ í•´ë‹¹ í—¤ë” ì´ë¦„ì— _ê°€ ë“¤ì–´ê°€ëŠ”ë° ì´ ì„¤ì •ì„ í•´ì£¼ì§€ ì•Šì€ ë°”ëŒì— ì¡°ê¸ˆ ë§ì´ ì• ë¥¼ ë¨¹ì—ˆì—ˆìŠµë‹ˆë‹¤...</p>\n<p>ì•„ë¬´íŠ¼ ì´ë ‡ê²Œí•˜ë©´ ë¦¬ì•¡íŠ¸ ì½”ë“œë¥¼ ë¹Œë“œí•œ ê²°ê³¼ë¬¼ì¸ ì •ì  íŒŒì¼ì„ ì„œë¸Œí•  ìˆ˜ ìˆëŠ” ì›¹ì„œë²„ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h4>backend</h4>\n<deckgo-highlight-code language=\"dockerfile\"  >\n          <code slot=\"code\">FROM openjdk:11\nARG JAR_FILE=build/libs/*.jar\nCOPY ${JAR_FILE} app.jar\nENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</code>\n        </deckgo-highlight-code>\n<p>ë¨¼ì € jdk 11 ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤. ì´ ì´ë¯¸ì§€ì—ëŠ” Java 11ì´ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\nê·¸ë¦¬ê³  ë¹Œë“œëœ jaríŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ app.jarë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë³µì‚¬ë¥¼ í•´ë‘¡ë‹ˆë‹¤.\nENTRYPOINTëŠ” ì»¨í…Œì´ë„ˆê°€ ì‹œì‘ë  ë•Œ ì‹¤í–‰ë˜ëŠ” ëª…ë ¹ì„ ì§€ì •í•  ìˆ˜ ìˆëŠ”ë° ì—¬ê¸°ì„œëŠ” java -jar /app.jar ëª…ë ¹ì„ ì§€ì •í•˜ì—¬ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ ë‚´ë¶€ì—ì„œ JARíŒŒì¼ì„ ì‹¤í–‰í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p>\n<h3>SSL ì¸ì¦ì„œ ë°œê¸‰</h3>\n<p>EC2 ë‚´ë¶€ì—ì„œ certbotì„ ì´ìš©í•´ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì•˜ìŠµë‹ˆë‹¤.</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">apt-get install python3-certbot-nginx\ncertbot certonly --nginx -d &lt;ë„ë©”ì¸ ì£¼ì†Œ&gt;</code>\n        </deckgo-highlight-code>\n<p>ì´ ì¸ì¦ì„œì˜ ë§Œë£Œê¸°í•œì€ 90ì¼ì´ë¼ .. 90ì¼ë§ˆë‹¤ ê°±ì‹ ì„ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. crontabì„ ì‚¬ìš©í•˜ë©´ ìë™ìœ¼ë¡œ ì¸ì¦ì„œë¥¼ ê°±ì‹ í•˜ë„ë¡ ì„¤ì •í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h3>docker-compose.yml íŒŒì¼ ìƒì„±</h3>\n<p>EC2ë‚´ë¶€ì—ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ë„ìš°ê¸° ìœ„í•´ docker-compose.ymlíŒŒì¼ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.</p>\n<deckgo-highlight-code language=\"yml\"  >\n          <code slot=\"code\">version: &#39;1&#39;\nservices:\n backend:\n  container_name: springboot-app\n  image: backend-image\n  expose:\n   - 8080\n\n frontend:\n  container_name: react-app\n  image: frontend-image\n  expose:\n   - 3000\n\n nginx:\n  container_name: nginx\n  image: nginx:latest\n  restart: always\n  volumes:\n   - ./conf/:/etc/nginx/conf.d\n   - /var/log/nginx:/var/log/nginx\n   - /etc/letsencrypt:/etc/letsencrypt\n  ports:\n   - 80:80\n   - 443:443\n  depends_on:\n   - backend\n   - frontend</code>\n        </deckgo-highlight-code>\n<p>backend, frontend, nginx ì´ 3ê°œì˜ ì„œë¹„ìŠ¤ë¥¼ ì •ì˜í•˜ê³  ê° ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë˜ëŠ” ë°©ì‹ ë° ì„¤ì •ì„ ì§€ì •í•œ íŒŒì¼ì…ë‹ˆë‹¤.</p>\n<h4>backend</h4>\n<p>'springboot-app'ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ë„ì›ë‹ˆë‹¤.\nì´ ì„œë¹„ìŠ¤ëŠ” docker hubì—ì„œ backend-imageë¼ëŠ” ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ì„œ ì‹¤í–‰ ì‹œí‚¤ê³  ì»¨í…Œì´ë„ˆë¥¼ 8080í¬íŠ¸ë¡œ ë…¸ì¶œí•©ë‹ˆë‹¤.</p>\n<h4>frontend</h4>\n<p>'react-app'ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ë„ì›ë‹ˆë‹¤.\nì´ ì„œë¹„ìŠ¤ëŠ” docker hubì—ì„œ frontend-imageë¼ëŠ” ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ì„œ ì‹¤í–‰ ì‹œí‚¤ê³  ì»¨í…Œì´ë„ˆë¥¼ 3000í¬íŠ¸ë¡œ ë…¸ì¶œí•©ë‹ˆë‹¤.</p>\n<h4>nginx</h4>\n<p>'react-app'ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ë„ì›ë‹ˆë‹¤.\nì´ ì„œë¹„ìŠ¤ëŠ” nginx ì´ë¯¸ì§€ë¡œ ì‹¤í–‰ì„ ì‹œí‚¤ëŠ”ë° í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ ë””ë ‰í† ë¦¬ë¥¼ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë””ë ‰í† ë¦¬ì™€ ê³µìœ í•˜ì—¬ nginx ì„¤ì •, ë¡œê·¸ ë° SSL ì¸ì¦ì„œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.\në˜ í˜¸ìŠ¤íŠ¸ì˜ 80ë²ˆ í¬íŠ¸ì™€ 443ë²ˆ í¬íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆì˜ 80ë²ˆ í¬íŠ¸ì™€ 443ë²ˆ í¬íŠ¸ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.</p>\n<p>./conf ê²½ë¡œì— ìˆëŠ” ì„¤ì • íŒŒì¼ë“¤ì„ nginxì„¤ì •ì— ì‚¬ìš©í•˜ë„ë¡ í•˜ì˜€ëŠ”ë° í•´ë‹¹ ì„¤ì •íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>\n<p><strong>nginx.conf</strong></p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">server {\n       listen 80;\n       server_name randps.kr;\n       underscores_in_headers on;\n       return 301 https://randps.kr$request_uri;   # httpë¡œ ë“¤ì–´ì˜¤ë©´ httpsë¡œ redirect í•´ì£¼ëŠ” ë¶€ë¶„\n}\n\nserver {\n       listen 443 ssl;\n\n       server_name randps.kr;\n\n       ssl_certificate /etc/letsencrypt/live/randps.kr/fullchain.pem;\n       ssl_certificate_key /etc/letsencrypt/live/randps.kr/privkey.pem;\n\n       location /api {\n\t       proxy_pass http://springboot-app:8080;\n\t       proxy_set_header Host $host;\n               proxy_set_header X-Real-IP $remote_addr;\n               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n               proxy_set_header X-Forwarded-Proto $scheme;\n               }\n       location / {\n               proxy_pass http://react-app:3000;\n               proxy_set_header Host $host;\n               proxy_set_header X-Real-IP $remote_addr;\n               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n               proxy_set_header X-Forwarded-Proto $scheme;\n       }\n       underscores_in_headers on;\n\n}</code>\n        </deckgo-highlight-code>\n<p>ì´ ì„¤ì •íŒŒì¼ì€ nginxë¥¼ ì‚¬ìš©í•˜ì—¬ HTTPSë¡œ ë³´ì•ˆëœ ì—°ê²°ì„ ì„¤ì •í•˜ê³  ë°±ì—”ë“œ APIì™€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í”„ë¡ì‹œí•˜ëŠ” ê°„ë‹¨í•œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ êµ¬ì„±ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.</p>\n<p>ë¨¼ì € 80í¬íŠ¸ë¡œ HTTPìš”ì²­ì„ ë°›ëŠ”ë‹¤ë©´ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ í•©ë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³  443 í¬íŠ¸ë¡œ HTTPS ìš”ì²­ì„ ë°›ìœ¼ë©° SSLì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ssl_certificate ë° ssl_certificate_keyëŠ” SSL ì¸ì¦ì„œì™€ ê°œì¸ í‚¤ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.</p>\n<p>Let's Encryptë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ etc/letsencrypt/live/randps.kr/fullchain.pem ë° /etc/letsencrypt/live/randps.kr/privkey.pem ê²½ë¡œì— ì¸ì¦ì„œì™€ í‚¤ íŒŒì¼ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</p>\n<p>ë˜ /api ê²½ë¡œë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ë°±ì—”ë“œ ì„œë²„ë¡œ í”„ë¡ì‹œ í•˜ê³  springboot-appì»¨í…Œì´ë„ˆì˜ 8080í¬íŠ¸ë¡œ ìš”ì²­ì„ ì „ë‹¬í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. ê·¸ ì™¸ì˜ /ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ìš”ì²­ì€ ì›¹ ì„œë²„ë¡œ í”„ë¡ì‹œ í•˜ì—¬ react-app ì»¨í…Œì´ë„ˆì˜ 3000í¬íŠ¸ë¡œ ìš”ì²­ì„ ì „ë‹¬í•˜ê²Œ ë©ë‹ˆë‹¤.</p>\n<h3>ë°°í¬</h3>\n<p>ë°°í¬ë¥¼ ìœ„í•œ ì¤€ë¹„ëŠ” ë‹¤ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  EC2ì—ì„œ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ë‚´ë ¤ë°›ì•„ ì‹¤í–‰ì‹œì¼œì£¼ê¸°ë§Œ í•˜ë©´ë©ë‹ˆë‹¤.</p>\n<p>ë¨¼ì € frontendì™€ backend ì´ë¯¸ì§€ë¥¼ ê°ê° ë¹Œë“œí•˜ì—¬ Docker hubì— ì˜¬ë ¤ì¤ë‹ˆë‹¤.</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">docker build --platform linux/amd64 -t &lt;image ì´ë¦„&gt; . // ì´ë¯¸ì§€ ë¹Œë“œ\ndocker push &lt;image ì´ë¦„&gt; // ì´ë¯¸ì§€ í‘¸ì‹œ</code>\n        </deckgo-highlight-code>\n<p>ì €ëŠ” M1 ë§¥ë¶ì„ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°, ì´ë¯¸ì§€ë¥¼ ê·¸ëƒ¥ ë¹Œë“œí•˜ê²Œ ë˜ë©´ ë„ì»¤ê°€ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí• ë•Œ ìƒì„±ëœ ë¹Œë“œ í”Œë«í¼ì´ EC2ì„œë²„ì™€ M1 ë§¥ë¶ê°„ì˜ í˜¸í™˜ì„±ì´ ì•ˆë§ì•„ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ë¥¼ linux/amd64 í”Œë«í¼ í˜•íƒœë¡œ ë¹Œë“œí•˜ê¸° ìœ„í•´ <code class=\"language-text\">--platform linux/amd64</code> ì˜µì…˜ì„ ì ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³  EC2ì—ì„œëŠ” ë‘ ì´ë¯¸ì§€ë¥¼ pull ë°›ì•„ì¤ë‹ˆë‹¤. (ë„ì»¤ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼í•˜ê³ , ë„ì»¤ í—ˆë¸Œì— ë¡œê·¸ì¸ ë˜ì–´ìˆì–´ì•¼ í•©ë‹ˆë‹¤.)</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">sudo docker pull &lt;backend image ì´ë¦„&gt;\nsudo docker pull &lt;frontend image ì´ë¦„&gt;</code>\n        </deckgo-highlight-code>\n<p>ê·¸ë¦¬ê³  docker-compose ëª…ë ¹ì–´ë¥¼ í†µí•´ ì´ë¯¸ì§€ë¥¼ ëª¨ë‘ ì‹¤í–‰ì‹œì¼œì£¼ë©´ ë°°í¬ê°€ ì™„ë£Œë©ë‹ˆë‹¤!</p>\n<deckgo-highlight-code   >\n          <code slot=\"code\">sudo docker-compose up -d // -d ì˜µì…˜ì€ ì»¨í…Œì´ë„ˆë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ì‹œí‚¤ëŠ” ì˜µì…˜</code>\n        </deckgo-highlight-code>\n<h2>ë°°í¬ ìë™í™”</h2>\n<p>dockerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„êµì  ê°„ë‹¨í•˜ê²Œ ë°°í¬ë¥¼ ì§„í–‰í•  ìˆ˜ëŠ” ìˆì§€ë§Œ ì´ ì‘ì—…ë§ˆì €ë„ ê·€ì°®ì€ ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤.. ìˆ˜ì • ì‚¬í•­ì´ ë°œìƒí•˜ë©´ ë§¤ë²ˆ ì´ë¯¸ì§€ë¥¼ ìƒˆë¡œ ë¹Œë“œí•˜ê³ , EC2ì— ì ‘ì†í•˜ì—¬ ìƒˆ ì´ë¯¸ì§€ë¥¼ pullë°›ì€ ë‹¤ìŒ ë‹¤ì‹œ ì‹¤í–‰ì‹œì¼œì¤˜ì•¼ í•©ë‹ˆë‹¤.</p>\n<p>ê·¸ë˜ì„œ ì´ ë¶€ë¶„ì„ ìë™í™” ì‹œì¼œë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; overflow: hidden!important; border-radius: 8px!important; margin-left: 0!important;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a414becd4834606010acd1c8ac1941e9/f0551/cicd.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.15942028985507%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4klEQVR42n1R22rDMAzN/3/O/mIPexlbWMogzQJL19HFdnxLfDmV7A5GaXdAWOhyjiQ3MUZs2wYG+yGE4ueMm7iO56tA8zVNaF+eYZ1D275i13Xw5Ctt8alAYgHGGEgpy5tvKVEsp1QJuSClWqSUKo0MnvQkFjjvywZa62KjyJhtxhqBhepPSkN0j9BPD5Xw+3jA++6N1C0+hgHjOMI5i8U4TDJiJTJPpNVWKA/4LSOkeqJIk1klYH6OlXCeBSZamzHs9+j7vk4YE6RDaUgXuwfe8vcQzd8EN7Hqf7j3WbhQngHCktSY/F+9fwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cicd\"\n        title=\"\"\n        src=\"/static/a414becd4834606010acd1c8ac1941e9/dd45a/cicd.png\"\n        srcset=\"/static/a414becd4834606010acd1c8ac1941e9/948cf/cicd.png 138w,\n/static/a414becd4834606010acd1c8ac1941e9/6b2ea/cicd.png 275w,\n/static/a414becd4834606010acd1c8ac1941e9/dd45a/cicd.png 550w,\n/static/a414becd4834606010acd1c8ac1941e9/d4c13/cicd.png 825w,\n/static/a414becd4834606010acd1c8ac1941e9/f0551/cicd.png 862w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ìë™í™” ë„êµ¬ë¡œëŠ” Github Actionsë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ê° Repository íŠ¹ì • ë¸Œëœì¹˜ì— í‘¸ì‹œí•˜ê²Œ ë˜ë©´, ìë™ìœ¼ë¡œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  EC2ì— ì ‘ì†í•˜ì—¬ ìƒˆ ì´ë¯¸ì§€ë¥¼ Pullë°›ì€ í›„ ì´ë¯¸ì§€ë“¤ì„ ë‹¤ì‹œ ì‹¤í–‰ì‹œì¼œì£¼ê²Œ ë©ë‹ˆë‹¤.</p>\n<h3>ê¹ƒí—ˆë¸Œ ì•¡ì…˜ íŒŒì¼ ì„¤ì •</h3>\n<p>ê¹ƒí—ˆë¸Œ ì•¡ì…˜ì€ yml íŒŒì¼ì„ í†µí•´ workflowë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì´ íŒŒì¼ì€ Repositoryì˜ Actionsíƒ­ì—ì„œ New workflowë¥¼ í´ë¦­í•˜ì—¬ ìƒì„±í•˜ê±°ë‚˜ Repositoryì— .github/workflows ë””ë ‰í† ë¦¬ ì•ˆì— yml íŒŒì¼ì„ ìƒì„±í•˜ì—¬ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<h4>frontend</h4>\n<deckgo-highlight-code language=\"yml\"  >\n          <code slot=\"code\">#front-deploy.yml\n\nname: Deploy\n\non:\npush:\nbranches:\n\n- main\n\njobs:\nbuild:\n\n# ì‹¤í–‰ í™˜ê²½ ì§€ì •\n\nruns-on: ubuntu-latest\n\nstrategy:\nmatrix:\nnode-version: [20.5.x]\n\nsteps:\n\n- uses: actions/checkout@v2\n- name: Use Node.js ${{ matrix.node-version }}\n  uses: actions/setup-node@v1\n  with:\n  node-version: ${{ matrix.node-version }}\n\n  # ë„ì»¤ ë¡œê·¸ì¸í•˜ê³  ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ í›„ í‘¸ì‹œí•œë‹¤.\n\n- name: web docker build and push\n  run: |\n  docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}\n  docker build --platform linux/amd64 -t ${{ secrets.DOCKER_USERNAME }}/randps-front .\n  docker push ${{ secrets.DOCKER_USERNAME }}/randps-front\n\n  # Github Actions IP ê°€ì ¸ì˜¨ë‹¤.\n\n- name: Get Github Actions IP\n  id: ip\n  uses: haythem/public-ip@v1.2\n\n- name: Configure AWS Credentials\n  uses: aws-actions/configure-aws-credentials@v1\n  with:\n  aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\n  aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n  aws-region: ap-northeast-2\n\n  # Github Actions IPë¥¼ AWS ë³´ì•ˆê·¸ë£¹ì— ì¶”ê°€í•œë‹¤.\n\n- name: Add Github Actions IP to Security group\n  run: |\n  aws ec2 authorize-security-group-ingress --group-id ${{ secrets.AWS_SG_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32\n\n  # sshë¡œ EC2 ì ‘ì†í•´ì„œ ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ ëª¨ë‘ ë©ˆì¶˜ í›„, ë„ì»¤ íŒŒì¼ì„ ìƒˆë¡œ ë°›ì•„ ë‹¤ì‹œ docker-composeë¡œ ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.\n\n- name: executing remote ssh commands using password\n  uses: appleboy/ssh-action@master\n  with:\n  host: ${{ secrets.HOST_ID }}\n  username: ubuntu\n  key: ${{ secrets.PRIVATE_KEY }}\n  script: |\n  sudo docker rm -f $(sudo docker ps -qa)\n  sudo docker pull ${{ secrets.DOCKER_USERNAME }}/randps-front\n  sudo docker-compose up -d\n  sudo docker image prune -f\n\n  # AWS ë³´ì•ˆê·¸ë£¹ì—ì„œ Github Actions IPë¥¼ ì‚­ì œí•œë‹¤.\n\n- name: Remove Github Actions IP From Security Group\n  run: |\n  aws ec2 revoke-security-group-ingress --group-id ${{ secrets.AWS_SG_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32```\n</code>\n        </deckgo-highlight-code>\n<p>ì´ íŒŒì¼ì€ GitHub Actionsë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•˜ê³  AWS EC2 ì¸ìŠ¤í„´ìŠ¤ì— ë°°í¬í•˜ëŠ” ì‘ì—…ì„ ì •ì˜í•©ë‹ˆë‹¤.</p>\n<p>ë¨¼ì € main ë¸Œëœì¹˜ë¡œì˜ push ì´ë²¤íŠ¸ì— ì˜í•´ íŠ¸ë¦¬ê±° ë˜ë©´ í•´ë‹¹ ì›Œí¬í”Œë¡œìš°ê°€ ubuntu-latest ìš´ì˜ì²´ì œ í™˜ê²½ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³  actions/setup-node@v1 ì•¡ì…˜ì„ ì‚¬ìš©í•˜ì—¬ Node.js í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>\n<p>ê·¸ ë‹¤ìŒì—ëŠ” docker loginì„ ì‚¬ìš©í•˜ì—¬ Docker Hubì— ë¡œê·¸ì¸í•˜ê³ \nì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  Docker Hubì— í‘¸ì‹œí•©ë‹ˆë‹¤.</p>\n<p>haythem/public-<a href=\"mailto:ip@v1.2\">ip@v1.2</a> ì•¡ì…˜ì„ ì‚¬ìš©í•˜ì—¬ GitHub Actionsì˜ ê³µìš© IP ì£¼ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ì´ IP ì£¼ì†ŒëŠ” ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</p>\n<p>AWS ìê²© ì¦ëª…ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ aws-actions/configure-aws-credentials@v1 ì•¡ì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ AWS ì„œë¹„ìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•˜ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.</p>\n<p>ê·¸ë¦¬ê³  AWS ë³´ì•ˆ ê·¸ë£¹ì— GitHub Actions IPë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.\naws ec2 authorize-security-group-ingress ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ AWS ë³´ì•ˆ ê·¸ë£¹ì— SSH í¬íŠ¸(22)ë¡œì˜ ì¸ë°”ìš´ë“œ ì•¡ì„¸ìŠ¤ë¥¼ GitHub Actionsì˜ IP ì£¼ì†Œë¡œ ì¶”ê°€í•©ë‹ˆë‹¤.</p>\n<p>appleboy/ssh-action@master ì•¡ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì›ê²© EC2 ì„œë²„ì— SSH ì—°ê²°í•˜ê³  ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.\nì›ê²© ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ëŠ” ëª…ë ¹ë“¤ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>\n<p>ë¨¼ì € í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ Docker ì»¨í…Œì´ë„ˆë¥¼ ëª¨ë‘ ì¤‘ì§€ ë° ì œê±°í•©ë‹ˆë‹¤.\nì´í›„ Docker Hubì—ì„œ ìƒˆë¡œìš´ í”„ë¡ íŠ¸ì—”ë“œ Docker ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ê³ , Docker Composeë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.\nê·¸ë¦¬ê³  ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” Docker ì´ë¯¸ì§€ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤.</p>\n<p>ì‘ì—…ì´ ì™„ë£Œë˜ë©´ aws ec2 revoke-security-group-ingress ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ AWS ë³´ì•ˆ ê·¸ë£¹ì—ì„œ GitHub Actions IP ì£¼ì†Œë¡œì˜ SSH ì•¡ì„¸ìŠ¤ë¥¼ ì œê±°í•©ë‹ˆë‹¤.</p>\n<h4>ê¹ƒí—ˆë¸Œ ì‹œí¬ë¦¿ ë“±ë¡</h4>\n<h4>backend</h4>\n<deckgo-highlight-code language=\"yml\"  >\n          <code slot=\"code\"># This workflow will build a Java project with Gradle\n# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-gradle\n\nname: Spring Boot &amp; Gradle CI/CD\n\non:\n push:\n  branches:\n   - master\n\njobs:\n build:\n  # ì‹¤í–‰ í™˜ê²½ ì§€ì •\n  runs-on: ubuntu-latest\n\n  steps:\n   - uses: actions/checkout@v2\n\n   - name: Set up JDK 11\n     uses: actions/setup-java@v1\n     with:\n      java-version: 11\n\n   - name: Grant execute permission for gradlew\n     run: chmod +x gradlew\n\n     # ìŠ¤í”„ë§ë¶€íŠ¸ ì½”ë“œ Build\n   - name: Build with Gradle\n     run: ./gradlew clean build\n\n     # ë„ì»¤ ë¡œê·¸ì¸í•˜ê³  ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ í›„ í‘¸ì‹œí•œë‹¤.\n   - name: web docker build and push\n     run: |\n      docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}\n      docker build --platform linux/amd64 -t ${{ secrets.DOCKER_USERNAME }}/randps-back .\n      docker push ${{ secrets.DOCKER_USERNAME }}/randps-back\n\n     # Github Actions IP ê°€ì ¸ì˜¨ë‹¤.\n   - name: Get Github Actions IP\n     id: ip\n     uses: haythem/public-ip@v1.2\n\n   - name: Configure AWS Credentials\n     uses: aws-actions/configure-aws-credentials@v1\n     with:\n      aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\n      aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n      aws-region: ap-northeast-2\n\n     # Github Actions IPë¥¼ AWS ë³´ì•ˆê·¸ë£¹ì— ì¶”ê°€í•œë‹¤.\n   - name: Add Github Actions IP to Security group\n     run: |\n      aws ec2 authorize-security-group-ingress --group-id ${{ secrets.AWS_SG_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32\n\n     # sshë¡œ EC2 ì ‘ì†í•´ì„œ ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ ëª¨ë‘ ë©ˆì¶˜ í›„, ë„ì»¤ íŒŒì¼ì„ ìƒˆë¡œ ë°›ì•„ ë‹¤ì‹œ docker-composeë¡œ ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.\n   - name: executing remote ssh commands using password\n     uses: appleboy/ssh-action@master\n     with:\n      host: ${{ secrets.HOST_ID }}\n      username: ubuntu\n      key: ${{ secrets.PRIVATE_KEY }}\n      script: |\n       sudo docker rm -f $(sudo docker ps -qa)\n       sudo docker pull ${{ secrets.DOCKER_USERNAME }}/randps-back\n       sudo docker-compose up -d\n       sudo docker image prune -f\n\n     # AWS ë³´ì•ˆê·¸ë£¹ì—ì„œ Github Actions IPë¥¼ ì‚­ì œí•œë‹¤.\n   - name: Remove Github Actions IP From Security Group\n     run: |\n      aws ec2 revoke-security-group-ingress --group-id ${{ secrets.AWS_SG_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32```</code>\n        </deckgo-highlight-code>\n<p>ë„ì»¤ ì´ë¯¸ì§€ ì´ë¦„ê³¼ ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ ì „ gradle build ë‹¨ê³„ê°€ ì¶”ê°€ëœ ê²ƒ ì´ì™¸ì—ëŠ” frontend ìª½ì˜ ë¡œì§ê³¼ ë™ì¼í•©ë‹ˆë‹¤.</p>\n<p>ì´ë ‡ê²Œ í•´ì£¼ê³  ì§€ì •í•œ ë¸Œëœì¹˜ì— í‘¸ì‹œí•˜ë©´ ìë™ìœ¼ë¡œ ë°°í¬ê°€ ë˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ì˜ˆì—</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%A0%84%EC%B2%B4%EC%A0%81%EC%9D%B8-%EA%B5%AC%EC%A1%B0\">ì „ì²´ì ì¸ êµ¬ì¡°</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B0%B0%ED%8F%AC-%EA%B3%BC%EC%A0%95\">ë°°í¬ ê³¼ì •</a></p>\n<ul>\n<li>\n<p><a href=\"#%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B5%AC%EC%9E%85-%EB%B0%8F-%EC%97%B0%EB%8F%99\">ë„ë©”ì¸ êµ¬ì… ë° ì—°ë™</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8F%84%EC%BB%A4-%ED%8C%8C%EC%9D%BC-%EC%9E%91%EC%84%B1\">ë„ì»¤ íŒŒì¼ ì‘ì„±</a></p>\n<ul>\n<li><a href=\"#frontend\">frontend</a></li>\n<li><a href=\"#nginxconf\">nginx.conf</a></li>\n<li><a href=\"#backend\">backend</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#ssl-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89\">SSL ì¸ì¦ì„œ ë°œê¸‰</a></p>\n</li>\n<li>\n<p><a href=\"#docker-composeyml-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1\">docker-compose.yml íŒŒì¼ ìƒì„±</a></p>\n<ul>\n<li><a href=\"#backend-1\">backend</a></li>\n<li><a href=\"#frontend-1\">frontend</a></li>\n<li><a href=\"#nginx\">nginx</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%B0%B0%ED%8F%AC\">ë°°í¬</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%B0%B0%ED%8F%AC-%EC%9E%90%EB%8F%99%ED%99%94\">ë°°í¬ ìë™í™”</a></p>\n<ul>\n<li>\n<p><a href=\"#%EA%B9%83%ED%97%88%EB%B8%8C-%EC%95%A1%EC%85%98-%ED%8C%8C%EC%9D%BC-%EC%84%A4%EC%A0%95\">ê¹ƒí—ˆë¸Œ ì•¡ì…˜ íŒŒì¼ ì„¤ì •</a></p>\n<ul>\n<li><a href=\"#frontend-2\">frontend</a></li>\n<li><a href=\"#%EA%B9%83%ED%97%88%EB%B8%8C-%EC%8B%9C%ED%81%AC%EB%A6%BF-%EB%93%B1%EB%A1%9D\">ê¹ƒí—ˆë¸Œ ì‹œí¬ë¦¿ ë“±ë¡</a></li>\n<li><a href=\"#backend-2\">backend</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Spring Boot/React ì›¹ ì„œë¹„ìŠ¤ ë°°í¬í•˜ê¸°","date":"September 13, 2023","description":"SSLì„ ì ìš©í•˜ê³  EC2ì™€ Docker, Nginxë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°í¬ë¥¼ í•´ë´¤ìŠµë‹ˆë‹¤.","category":"í”„ë¡œì íŠ¸","icon":"ğŸŒ"}},"previous":{"fields":{"slug":"/csr-ssr/"},"frontmatter":{"title":"CSRê³¼ SSR"}},"next":null},"pageContext":{"id":"4d9d8f78-9ab5-528a-8fbf-892acff26925","previousPostId":"c6e1d8a1-e51a-55bb-8813-024c41300f28","nextPostId":null}},"staticQueryHashes":["2841359383"],"slicesMap":{}}